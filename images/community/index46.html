<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <title>ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œíŒ</title>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
      * {
        box-sizing: border-box;
      }

      /* ìˆ¨ê²¨ì§„ ìš”ì†Œ ìŠ¤íƒ€ì¼ */

      .hidden {
        display: none;
      }
      /* ê¸°ë³¸ ë°”ë”” ìŠ¤íƒ€ì¼ */

      body {
        margin: 0;
        padding: 0;
      }

      /* ê²Œì‹œíŒ íƒ€ì´í‹€ ìŠ¤íƒ€ì¼ */
      .title-wrapper {
        background-color: #f9d6e8;
        height: 50px;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .title {
        font-size: 30px;
        font-weight: bold;
        color: #ffffff;
        font-family: "ë§‘ì€ ê³ ë”•", "Arial", sans-serif;
      }

      /* ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
      .comments-list {
        list-style-type: none;
        padding: 0;
      }
      
      /* ë²„íŠ¼ ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
      .button-list {
        display: flex;
        flex-direction: column;
      }

      /* ë²„íŠ¼ ê·¸ë£¹ ìŠ¤íƒ€ì¼ */
      .btn-group {
        margin-bottom: 1rem;
      }

      /* ê²Œì‹œë¬¼ ë¦¬ìŠ¤íŠ¸ ë§ˆì§„ ìŠ¤íƒ€ì¼ */
      #post-list {
        margin-top: 1.5rem;
      }

      /* ì´ëª¨í‹°ì½˜ í¼ */
      .emoji-picker {
  display: none;
  position: absolute;
  z-index: 2; /* ì¶”ê°€ */
  background-color: white; /* ì¶”ê°€ */
  padding: 1rem; /* ì¶”ê°€ */
  border: 1px solid #ccc; /* ì¶”ê°€ */
  border-radius: 5px; /* ì¶”ê°€ */
}

        /* ì´ëª¨í‹°ì½˜ ë²„íŠ¼ */
        .emoji-button {
          position: relative;
        }
    </style>
  </head>
  <body>
  <!-- íƒ€ì´í‹€ í‘œì‹œ -->
    <div class="title-wrapper">
      <span class="title">ë‚˜í˜¼ìì‚´ë˜</span>
    </div>
  <!-- ì»¨í…Œì´ë„ˆ ì„¤ì • -->
    <div class="container">
      <h1 class="my-4">ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œíŒ</h1>
      <div>
        <!-- ë²„íŠ¼ ê·¸ë£¹ ì„¤ì • -->
        <div class="col-md-8 button-list">
          <div class="btn-group" role="group">
            <button id="writeButton" onclick="showPostWrite();" class="btn btn-primary mb-4">ê¸€ ì‘ì„±í•˜ê¸°</button>
            <button id="allPostsButton" onclick="showAllPosts();" class="btn btn-info mb-4">ì „ì²´ ê¸€ ë³´ê¸°</button>
            <button id="categoryPostsButton1" onclick="showCategoryPosts('ì—¬í–‰ì§€');" class="btn btn-info mb-4">ì—¬í–‰ì§€ ê¸€ë³´ê¸°</button>
            <button id="categoryPostsButton2" onclick="showCategoryPosts('ìƒí™œ');" class="btn btn-info mb-4">ìƒí™œ ê¸€ë³´ê¸°</button>
            <button id="topPostsButton" onclick="showTopPosts();" class="btn btn-info mb-4">ì¶”ì²œ ë§ì´ ë°›ì€ ê¸€ ë³´ê¸°</button>
          </div>
          <!-- ê²Œì‹œë¬¼ ë¦¬ìŠ¤íŠ¸ ìˆ¨ê¹€ ì„¤ì • -->
          <ul id="post-list" class="hidden"></ul>
        </div>

        <!-- ì‘ì„± í¼ ì„¤ì • ë° ë°˜ì‘ ì„¤ì • -->
        <form id="post-write-form" class="post-write hidden" onsubmit="return false;">
          <div class="form-group">
            <label for="post-title">ì œëª©</label>
            <input type="text" class="form-control" id="post-title" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
          </div>
          <div class="form-group">
            <label for="post-category">ì¹´í…Œê³ ë¦¬</label>
            <select class="form-control" id="post-category">
              <option value="ì¡ë‹´">ì¡ë‹´</option>
              <option value="ì—¬í–‰ì§€">ì—¬í–‰ì§€</option>
              <option value="ìƒí™œ">ìƒí™œ</option>
            </select>
          </div>
          <div class="form-group">
            <label for="post-content">ë‚´ìš©</label>
            <textarea class="form-control" id="post-content" rows="5" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
          </div>
          <div class="form-group">
            <label for="post-image">ì´ë¯¸ì§€ ì²¨ë¶€</label>
            <input type="file" class="form-control-file" id="post-image" accept="image/*">
          </div>
          <!-- ìœ íŠœë¸Œ ë§í¬ ì…ë ¥ ì„¤ì • -->
          <div class="form-group">
            <label for="youtube-url">ìœ íŠœë¸Œ URL (ì„ íƒ):</label>
            <input type="text" class="form-control" id="youtube-url" placeholder="ìœ íŠœë¸Œ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”">
          </div>
          <button onclick="savePost();" class="btn btn-primary">ì‘ì„±ì™„ë£Œ</button>
          <button onclick="showPostList();" type="button" class="btn btn-secondary">ì·¨ì†Œ</button>
        </form>

        <!-- ê²Œì‹œë¬¼ ë””í…Œì¼ ì„¤ì • -->
        <div id="post-view" class="post-view hidden"></div>
      </div>
    </div>

    <script>
  /* ì´ˆê¸°í™” ë° ì „ì—­ ë³€ìˆ˜ ì„¤ì • */
  let currentPostIndex;
  const savedPosts = [];
  const postListElem = document.getElementById('post-list');
  const postWriteForm = document.getElementById('post-write-form');
  const postView = document.getElementById('post-view');

  /* í¼ ì´ˆê¸°í™” í•¨ìˆ˜ */
  function resetForm() {
    document.getElementById('post-title').value = '';
    document.getElementById('post-content').value = '';
    document.getElementById('post-image').value = '';
    document.getElementById('youtube-url').value = ''; // ì¶”ê°€
  }

  /* ì‘ì„±í™”ë©´ ì—´ê¸° í•¨ìˆ˜ */
  function showPostWrite() {
    postListElem.classList.add('hidden');
    postWriteForm.classList.remove('hidden');
    postView.classList.add('hidden');
  }

  /* ë¦¬ìŠ¤íŠ¸í™”ë©´ ì—´ê¸° í•¨ìˆ˜ */
  function showPostList() {
    postListElem.classList.remove('hidden');
    postWriteForm.classList.add('hidden');
    postView.classList.add('hidden');
    resetForm();
    renderPostList();
    document.getElementById('writeButton').style.display = 'block';
    document.getElementById('topPostsButton').style.display = 'block';
    document.querySelector('.btn-group').classList.remove('hidden');
  }

  /* ë””í…Œì¼ í™”ë©´ ì—´ê¸° í•¨ìˆ˜ */
  function showPostDetail(index) {
    postListElem.classList.add('hidden');
    postWriteForm.classList.add('hidden');
    postView.classList.remove('hidden');
    renderPostDetail(index);
    document.getElementById("writeButton").style.display = "none";
    document.getElementById("topPostsButton").style.display = "none";
    document.querySelector('.btn-group').classList.add('hidden');
    renderPostDetail(index);
    document.getElementById('post-list').classList.add('hidden');
  }

  /* ì‘ì„± ë‚´ìš© ì €ì¥ í•¨ìˆ˜ */
  function savePost() {
    const title = document.getElementById('post-title').value;
    const content = document.getElementById('post-content').value;
    const file = document.getElementById('post-image').files[0];
    const youtubeUrl = document.getElementById('youtube-url').value;
    const category = document.getElementById('post-category').value;

    /* ì €ì¥ */
    savedPosts.push({
      title,
      content,
      file,
      youtubeUrl,
      category,
      upVotes: 0,
      downVotes: 0,
      comments: [],
    });

    showPostList();
  }

  /* ê²Œì‹œë¬¼ ë¦¬ìŠ¤íŠ¸ ë Œë” í•¨ìˆ˜ */
  function renderPostList(posts = savedPosts) {
    postListElem.innerHTML = '';

    posts.forEach((post, index) => {
      postListElem.innerHTML += `
          <li class="list-group-item" onclick="showPostDetail(${index})">
              <span>${post.title}</span> - <span>${post.category}</span>
          </li>`;
    });
  }

  /* ê²Œì‹œë¬¼ ë””í…Œì¼ ë Œë” í•¨ìˆ˜ */
  function renderPostDetail(index) {
    currentPostIndex = index;
    const post = savedPosts[index];
    const reader = new FileReader();
    const videoId = getYouTubeVideoId(post.youtubeUrl); // ì¶”ê°€

    reader.onloadend = function () {
      postView.innerHTML = `
          <h2>${post.title}</h2>
          ${post.file ? `<img src="${reader.result}" alt="" >` : ''}
          <p>${post.content}</p>
          ${post.youtubeUrl ? `<iframe width="560" height="315" src="https://www.youtube.com/embed/${videoId}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>` : ""}
          <div class="mt-3">
              <button id="upvote-count" onclick="upVote(currentPostIndex)" class="btn btn-link">&#128077; ${post.upVotes}</button>
              <button id="downvote-count" onclick="downVote(currentPostIndex)" class="btn btn-link">&#128078; ${post.downVotes}</button>
              <button onclick="showPostList()" class="btn btn-secondary">ë’¤ë¡œ</button>
          </div>
          <div id="comments-section">
              <h2>ëŒ“ê¸€ ëª©ë¡</h2>
              <ul id="comments-list" class="comments-list"></ul>
              <h5>ëŒ“ê¸€ ì‘ì„±</h5>
              <form id="comment-form" onsubmit="addComment(); return false;">
                  <input type="text" class="form-control" id="comment-text" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”">
                  <button id="comment-submit" class="btn btn-primary mt-2">ëŒ“ê¸€ë‹¬ê¸°</button>
              </form>
          </div>`;
      renderEmojiPicker();
      renderComments();
    };

    if (post.file) {
      reader.readAsDataURL(post.file);
    } else {
      reader.onloadend();
    }

    renderComments(); // ì¶”ê°€
  }

  

  /* ëŒ“ê¸€ ì‘ì„± */
  function addComment() {
    const rawCommentText = $("#comment-text").val();
    const commentText = rawCommentText.trim();
    const commentAuthor = "ì‚¬ìš©ì ë‹‰ë„¤ì„"; // ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë‹‰ë„¤ì„ìœ¼ë¡œ ë³€ê²½í•´ì•¼ í•©ë‹ˆë‹¤.

    if (commentText.length === 0) {
      alert("ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.");
      return;
    }

    const commentTime = new Date().toLocaleString();
    savedPosts[currentPostIndex].comments.push({
      text: rawCommentText,
      author: commentAuthor,
      time: commentTime,
    });
    $("#comment-text").val("");
    renderComments();
  }

  /* ì´ëª¨í‹°ì½˜ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ í•¨ìˆ˜ */
   function onEmojiButtonClick(event) {
    event.preventDefault(); 
    // event.stopImmediatePropagation();
    toggleEmojiPicker();
  }
  document.addEventListener("click", () => {
  const emojiPicker = document.getElementById("emoji-picker");
  if (emojiPicker.style.display === "block") {
    emojiPicker.style.display = "none";
  }
});

  /* ì´ëª¨í‹°ì½˜ ì„ íƒì°½ ë Œë”ë§ */
  function renderEmojiPicker() {
    const emojiPicker = document.createElement("div");
    emojiPicker.id = "emoji-picker";
    emojiPicker.className = "emoji-picker";
    emojiPicker.innerHTML = `
      <button onclick="insertEmoji('ğŸ˜Š')">ğŸ˜Š</button>
      <button onclick="insertEmoji('ğŸ˜')">ğŸ˜</button>
      <button onclick="insertEmoji('ğŸ˜‚')">ğŸ˜‚</button>
      <button onclick="insertEmoji('ğŸ˜')">ğŸ˜</button>
      <button onclick="insertEmoji('ğŸ˜¢')">ğŸ˜¢</button>`;
    document.getElementById("comments-section").appendChild(emojiPicker);

    const emojiButton = document.createElement("div");
    emojiButton.className = "emoji-button";
    emojiButton.innerHTML = `<button>ì´ëª¨í‹°ì½˜</button>`;
    emojiButton.addEventListener("click", (event) => {
  event.stopPropagation();
  toggleEmojiPicker();
});
   
    document.getElementById("comment-form").appendChild(emojiButton);
  }

  /* ì´ëª¨í‹°ì½˜ ì„ íƒì°½ í† ê¸€ */
  function toggleEmojiPicker() {
    const emojiPicker = document.getElementById("emoji-picker");
    if (emojiPicker.style.display === "none") {
      emojiPicker.style.display = "block";
    } else {
      emojiPicker.style.display = "none";
    }
  }

  /* ì´ëª¨í‹°ì½˜ ì‚½ì… ê¸°ëŠ¥ êµ¬í˜„ */
  function insertEmoji(emoji) {
    const commentInput = document.getElementById("comment-text");
    commentInput.value += emoji;
    toggleEmojiPicker();
    commentInput.focus();
  }

  function renderComments() {
  const commentsList = document.getElementById("comments-list");
  const post = savedPosts[currentPostIndex];
  commentsList.innerHTML = '';

  post.comments.forEach((comment) => {
    commentsList.innerHTML += `
      <li>
        <p class="comment-author">${comment.author}</p>
        <p class="comment-text">${comment.text}</p>
        <p class="comment-time">${comment.time}</p>
      </li>`;
  });
}

  /* ìœ íŠœë¸Œ URLì—ì„œ ë¹„ë””ì˜¤ ID ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜ ì¶”ê°€ */
  function getYouTubeVideoId(url) {
    const regExp = /^.*(youtu.be\/|v\/|e\/|u\/\w+\/|embed\/|v=)([^#&?]*).*/;
    const match = url.match(regExp);

    return match && match[2].length === 11 ? match[2] : "-";
  }

  document.querySelector(".emoji-button > button").addEventListener("click", (event) => {
  event.stopPropagation();
  toggleEmojiPicker();
});
</script>

  </body>
</html>
